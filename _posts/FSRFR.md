
## FreeSurfer Overview: 

FreeSurfer is a software package that enables you to analyze structural MRI images - in other words, you can use FreeSurfer to quantify the amount of grey matter and white matter in specific regions of the brain. You will also be able to calculate measurements such as the thickness, curvature, and volume of the different tissue types, and be able to correlate these with covariates; or, you can contrast these structural measurements between groups.

Virtually all neuroimaging studies acquire a T1-weighted anatomical scan: A high-resolution image with high contrast between the white matter and the grey matter. In these images white matter is lighter, grey matter is darker, and cerebrospinal fluid is black. These are the images that will be used by FreeSurfer to partition the cortical surface and the subcortical structures into distinct areas.

Instead of analyzing the brain as a 3D volume, however, FreeSurfer transforms the cortex into a 2D surface. Why a 2D surface? Picture a voxel that straddles both edges of a sulcus. The voxel contains a mixture of signals from both regions, and it is impossible to determine which region contributed to the signal - a problem known as the partial voluming effect.

We run into a similar problem with a voxel that contains two or more different tissue types. Picture a voxel that contains grey matter, white matter, and cerebrospinal fluid. In this case we cannot tell how much of each is contained by that voxel: It is a single number which represents each of the different tissue types within the voxel, but it is impossible to tell how much of each tissue type is within the voxel.

FreeSurfer gets around this problem by tracing the boundaries between the different tissues of the brain - grey and white matter, grey and pial matter, and so on - and then inflating those surfaces into spheres. Most of the leftover defects in the inflated surface are automatically corrected (although some defects need to be fixed manually). These surfaces can then be rendered as partially inflated, fully inflated, or spherical brains.

To help you better understand what FreeSurfer does, picture this: You’ve just removed someone’s brain and placed it on the table. The brain is like a flaccid balloon, with the wrinkles representing the gyri and sulci of the cortex. Now, you put your mouth on the severed brainstem (after washing it with soap and hot water, of course) and blow as hard as you can, inflating the brain to its maximum extent. The wrinkles disappear and the brain becomes a fully inflated balloon, like a sphere. This is a different way to view your data - instead of using voxels as the building blocks of our image, we use vertices and edges. Think of these vertices and edges as a chain link fence wrapped around the surface of the cortex; the links are the edges and the intersections of the links are the vertices. The vertex is now our smallest resolution element, and at each vertex we can calculate structural measurements such as thickness, volume, and surface area.


Once you’ve reconstructed the surface you can resample your fMRI statistical maps and view them on an inflated surface, or deflate the surface and see where the activation lies on the original, wrinkled cortex. This gives you a better picture of how the statistical maps lie along the ridges and valleys of the brain. (For a practical exercise in analyzing fMRI data on the surfaces generated by FreeSurfer, see this module.

FreeSurfer uses the reconstructed surface, along with prior knowledge about the topology of a typical human brain, to label the cortical and subcortical structures. The labeling of the cortex is called Parcellation, and the labeling of the subcortical structures is called Segmentation. These labelings are based on the two atlases that come with FreeSurfer: The Desikan-Killiany atlas and the Destrieux atlas, with the Destrieux atlas containing finer-grained parcellations. Structural measurements are then averaged within each parcellation. These measures can be compared across groups, or correlated with some individual difference measure, such as age, IQ, or sex.



## Reconstructing the Cortical Surface : Recon-all

FreeSurfer contains a large suite of programs which can take several hours to process a single subject, and days to process an entire dataset. Fortunately, the processing itself is very simple to do - FreeSurfer has a single command that, when executed, does virtually all of the most tedious parts of preprocessing a single subject. This command, recon-all, is easy to use and requires only a few arguments in order to run. Later on, you will learn how to execute multiple recon-all commands simultaneously, which will save you a considerable amount of time.

Recon-all stands for reconstruction, as in reconstructing a two-dimensional cortical surface from a three-dimensional volume. The images we collect from an MRI scanner are three-dimensional blocks, and these images are transformed by recon-all into a smooth, continuous, two-dimensional surface - similar to taking a paper lunch bag crumpled into the size of a pellet, and then blowing into it to expand it like a balloon.

The Output of Recon-all

Before discussing how to use the recon-all command, it is informative to see examples of what it creates. Recon-all first strips the skull from the anatomical image to generate a dataset called brainmask.mgz. (The .mgz extension stands for a compressed, or zipped, Massachusetts General Hospital file; it is an extension specific to FreeSurfer, similar to AFNI’s BRIK/HEAD extension.) Any files that are output as three-dimensional volumes are stored in a folder called mri. Recon-all then estimates where the interface is between the white matter and grey matter for both hemispheres, and these surface estimates are stored in files called lh.orig and rh.orig.

This initial estimate is refined and then saved into files called lh.white and rh.white. This boundary is then used as a base from which recon-all extends feelers to search for the edge of the grey matter. Once this edge is reached, a third pair of datasets are created: lh.pial and rh.pial. These datasets represent the pial surface, which is like a plastic film wrapped around the edge of the grey matter.



One of the advantages of using these surfaces is the ability to depict within the sulci measurements such as cortical thickness differences or the BOLD signal. In a three-dimensional volume, it is possible for a single voxel to span two separate ridges of grey matter, which makes it impossible to determine which part of the cortex generates the observed signal. To more easily see where the activation maps lie along the banks of the sulci and the ridges of the gyri, the surface datasets can be further expanded to create the datasets lh.inflated and rh.inflated.


These inflated surfaces can be inflated yet again, this time into a sphere. This is not an image that you would use to visualize your results; it is an image that is instead normalized to a template image called fsaverage, an average of 40 subjects, and then re-shaped into an inflated surface or a pial surface. Once the individual subject’s surface map is normalized to this template, an atlas can be used to parcellate the cortex into anatomically distinct regions. Recon-all will parcellate the individual subject’s brain according to two atlases: The Desikan-Killiany atlas, and the Destrieux atlas. The Destrieux atlas contains more parcellations; which one you use for your analysis will depend on how fine-grained an analysis you wish to perform.


As you will soon find out, FreeSurfer takes a long time to process an individual subject - around sixteen to twenty-four hours on a typical iMac, with some variation due to factors such as the quality of the input data. For many researchers, this can be a prohibitively long time to wait, especially if the study contains dozens or hundreds of subjects.

One way to reduce the amount of time it takes to analyze so many subjects is to run the analyses in parallel. Modern computers typically have a central processing unit with several cores, which can be individually used for different tasks. To illustrate what cores are, picture eight men and eight kitchens, with each kitchen only big enough for one man to prepare his meal. In this analogy, each computer core is a kitchen. Eight men cannot fit into one kitchen, but if the other kitchens are unlocked and made available for use, each man can make his own meal in each room.

Let’s assume that each meal takes one hour to make. Instead of each man waiting his turn for the same kitchen every hour, everybody makes their meals simultaneously. What would otherwise take eight hours - that is, for all of the men to make their meal in the same kitchen - now takes one hour. If we could do something similar with our data analysis, we could finish processing the anatomical images in a more reasonable amount of time.

## Viewing Your Data

Each neuroimaging software package has a data viewer, or an application that allows you to look at your data. AFNI, SPM, and FSL all have data viewers which basically do the same thing: the user loads imaging data, usually anatomical or functional images, and can view them in three dimensions. Most viewers are able to load NIFTI files that contains any kind of imaging data.

FreeSurfer has its own viewer called Freeview, which can by launched from the Terminal by typing freeview and pressing enter. It can load NIFTI images just like the other packages, and in addition it can load FreeSurfer-specific formats, such as data with .mgz and .inflated extensions. The image can be viewed in all three dimensions in the Viewing Panel, or you can change the layout so that only one viewing dimension is displayed.

Freeview can load both volumes and surfaces at the same time. To load a surface, click File -> Load Surface, and select an image in the surf directory, such as lh.pial. This will overlay a 3D representation of the surface in the three-dimensional box of the View window, and will trace the outline of the surface in the orthogonal boxes (i.e., the sagittal, axial, and coronal views). The color of the surface in the orthogonal views can be changed by selecting a new Edge color.

## VBM in FreeSurfer


# References

[FSL](https://www.youtube.com/watch?v=3ExL6J4BIeo&list=PLvgasosJnUVl_bt8VbERUyCLU93OG31h_)
