## Introduction


Preprocessing of functional magnetic resonance imaging (fMRI) involves numerous steps to clean and standardize the data before statistical analysis. Generally, researchers create ad hoc preprocessing workflows for each dataset, building upon a large inventory of available tools. The complexity of these workflows has snowballed with rapid advances in acquisition and processing. We introduce fMRIPrep, an analysis-agnostic tool that addresses the challenge of robust and reproducible preprocessing for fMRI data. fMRIPrep automatically adapts a best-in-breed workflow to the idiosyncrasies of virtually any dataset, ensuring high-quality preprocessing without manual intervention. By introducing visual assessment checkpoints into an iterative integration framework for software testing, we show that fMRIPrep robustly produces high-quality results on a diverse fMRI data collection. Additionally, fMRIPrep introduces less uncontrolled spatial smoothness than observed with commonly used preprocessing tools. fMRIPrep equips neuroscientists with an easy-to-use and transparent preprocessing workflow, which can help ensure the validity of inference and the interpretability of results.

The fMRIPrep workflow takes as principal input the path of the dataset that is to be processed. The input dataset is required to be in valid BIDS format, and it must include at least one T1w structural image and (unless disabled with a flag) a BOLD series. We highly recommend that you validate your dataset with the free, online BIDS Validator.

The exact command to run fMRIPRep depends on the Installation method. The common parts of the command follow the BIDS-Apps definition. 

### Running fMRIPrep 
Timing 2–15 h of computing time per subject, depending on the number and resolution of BOLD runs, T1w reference quality, data acquisition parameters (e.g., longer for multiband fMRI data) and the workflow configuration 10 Run fMRIPrep. Figure 2 describes an example of batch prescription file $STUDY/fmriprep. sbatch and the elements that may be customized for the particular execution environment.

### Inspection of all visual reports generated by fMRIPrep
Timing 5–20 min per subject, depending on the number of BOLD runs Alongside the corresponding preprocessed data (Box 3, Outcomes), fMRIPrep will generate one HTML (hypertext markup language) report per subject. Screen these reports to ensure sufficient quality of preprocessed data (e.g., accuracy of image registration processes, correctness of artifact correction techniques, etc.). Checking the visual reports from fMRIPrep ensures that the T1w reference brain was accurately extracted, adequate susceptibility distortion correction was correctly applied, an acceptable brain mask was calculated from the BOLD signal, the alignment of BOLD and T1w data was accurate, etc. If the report is satisfactory, proceed to the next step.

### Running first-level analysis on a preprocessed dataset 
Timing 5–60 min of computing time, depending on the number of BOLD runs and the workflow configuration 13 Determine an appropriate workflow and model design to be used for computing voxelwise activation contrasts. For this purpose, we provide reference Nipype workflows36 that execute first- and secondlevel analysis on the example dataset using tools from FSL (principally FEAT, FMRIB’s improved linear model (FILM), and FMRIB’s local analysis of mixed effects (FLAME)). To make use of these workflows with a new dataset, the code should be modified so that the statistical analysis is performed using the most appropriate contrasts. Create a batch prescription file $STUDY/analysis.sbatch akin to the script proposed in Fig. 2, replace the Singularity image with the one packing the analysis workflow36 and finally submit the job to the scheduler: sbatch $STUDY/analysis.sbatch.

### Visualization of results 
Timing 5–20 min 14 Visualize results with Nilearn’s plotting functions. Here, we list examples of figures that can beenerated, although most neuroimaging toolboxes include alternative utilities as well.

## References

https://fmriprep.org/en/stable/usage.html
https://github.com/poldracklab/ds003-post-fMRIPrep-analysis
https://github.com/nipreps/fmriprep
Analysis of task-based functional MRI data preprocessed with fMRIPrep
fMRIPrep: a robust preprocessing pipeline for functional MRI
